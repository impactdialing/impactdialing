<% content_for :javascripts do %>
<script type="text/javascript" src="https://static.twilio.com/libs/twiliojs/1.0/twilio.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.js"></script>
<script src="https://d3dy5gmtp8yhk7.cloudfront.net/1.11/pusher.min.js" type="text/javascript" ></script>
<%= javascript_include_tag 'monitors/jquery.stopwatch', 'monitors/monitors', 'monitors/assign_caller_to_campaign','ICanHaz.min.js' %>

<% end %>

<input id= "monitor_session_id" type="hidden" value="<%= @monitor_session %>">
<%= render :partial => 'campaign' %>
<%= render :partial => 'callers' %>

<script type="text/javascript">
  var pusher = new Pusher("<%= Pusher.key %>");      
  channel = pusher.subscribe($('#monitor_session_id').val());
  var monitors = new Monitors(channel)
  monitors.setup_twilio("<%= @token %>")
  $(window).bind("beforeunload", function(){
    monitors.de_activate_monitor("<%= @campaign.id %>", $('#monitor_session_id').val());
    pusher.disconnect();
  });      
</script>
